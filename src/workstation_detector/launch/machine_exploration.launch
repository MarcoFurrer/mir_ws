<launch>
    <!-- Load the map using an absolute path to ensure the correct map is loaded -->
    <arg name="map_file" default="$(env HOME)/mir_ws/map/game_s12.yaml"/>
    <node name="map_server" pkg="map_server" type="map_server" args="$(arg map_file)" respawn="false" />

    <!-- Run AMCL for localization -->
    <include file="$(find mir_navigation)/launch/amcl.launch" />
    
    <!-- Run move_base for navigation -->
    <include file="$(find mir_navigation)/launch/start_planner.launch" />
    
    <!-- Machine detection node -->
    <node name="machine_detector" pkg="workstation_detector" type="workstation_detector.py" output="screen" />
    
    <!-- Exploration controller -->
    <node name="exploration_controller" pkg="workstation_detector" type="exploration_controller.py" output="screen" />
    
    <!-- RViz for visualization -->
    <node name="rviz" pkg="rviz" type="rviz" args="-d $(find workstation_detector)/rviz/machine_exploration.rviz" />
</launch>